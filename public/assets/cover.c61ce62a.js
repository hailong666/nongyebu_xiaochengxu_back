import{m as K,r as U,n as S,p as Q,d as W,c as Z,e as x,w as F,F as ee,E as te,q,g as B,o as ne,b as k,k as A,z as oe,s as ae,v as re}from"./index.f931844d.js";import{g as ie,a as ce,u as ue,b as se,d as le}from"./index.dadfe553.js";var J={exports:{}},V={exports:{}};(function(I,j){(function(v,s){I.exports=s()})(K,function(){return function(v){var s={};function c(r){if(s[r])return s[r].exports;var l=s[r]={i:r,l:!1,exports:{}};return v[r].call(l.exports,l,l.exports,c),l.l=!0,l.exports}return c.m=v,c.c=s,c.d=function(r,l,_){c.o(r,l)||Object.defineProperty(r,l,{enumerable:!0,get:_})},c.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},c.t=function(r,l){if(1&l&&(r=c(r)),8&l||4&l&&typeof r=="object"&&r&&r.__esModule)return r;var _=Object.create(null);if(c.r(_),Object.defineProperty(_,"default",{enumerable:!0,value:r}),2&l&&typeof r!="string")for(var P in r)c.d(_,P,function(p){return r[p]}.bind(null,P));return _},c.n=function(r){var l=r&&r.__esModule?function(){return r.default}:function(){return r};return c.d(l,"a",l),l},c.o=function(r,l){return Object.prototype.hasOwnProperty.call(r,l)},c.p="",c(c.s=0)}([function(v,s,c){var r;function l(o){return["image/png","image/jpeg","image/gif"].some(t=>t===o)}c.r(s),c.d(s,"canvastoDataURL",function(){return P}),c.d(s,"canvastoFile",function(){return p}),c.d(s,"dataURLtoFile",function(){return w}),c.d(s,"dataURLtoImage",function(){return E}),c.d(s,"downloadFile",function(){return C}),c.d(s,"filetoDataURL",function(){return y}),c.d(s,"imagetoCanvas",function(){return O}),c.d(s,"urltoBlob",function(){return T}),c.d(s,"urltoImage",function(){return $}),c.d(s,"compress",function(){return X}),c.d(s,"compressAccurately",function(){return Y}),c.d(s,"EImageType",function(){return r}),function(o){o.PNG="image/png",o.JPEG="image/jpeg",o.GIF="image/gif"}(r||(r={}));var _=function(o,t,n,e){return new(n||(n=Promise))(function(i,d){function h(u){try{m(e.next(u))}catch(a){d(a)}}function f(u){try{m(e.throw(u))}catch(a){d(a)}}function m(u){var a;u.done?i(u.value):(a=u.value,a instanceof n?a:new n(function(b){b(a)})).then(h,f)}m((e=e.apply(o,t||[])).next())})};function P(o,t=.92,n=r.JPEG){return _(this,void 0,void 0,function*(){return l(n)||(n=r.JPEG),o.toDataURL(n,t)})}function p(o,t=.92,n=r.JPEG){return new Promise(e=>o.toBlob(i=>e(i),n,t))}var g=function(o,t,n,e){return new(n||(n=Promise))(function(i,d){function h(u){try{m(e.next(u))}catch(a){d(a)}}function f(u){try{m(e.throw(u))}catch(a){d(a)}}function m(u){var a;u.done?i(u.value):(a=u.value,a instanceof n?a:new n(function(b){b(a)})).then(h,f)}m((e=e.apply(o,t||[])).next())})};function w(o,t){return g(this,void 0,void 0,function*(){const n=o.split(",");let e=n[0].match(/:(.*?);/)[1];const i=atob(n[1]);let d=i.length;const h=new Uint8Array(d);for(;d--;)h[d]=i.charCodeAt(d);return l(t)&&(e=t),new Blob([h],{type:e})})}function E(o){return new Promise((t,n)=>{const e=new Image;e.onload=()=>t(e),e.onerror=()=>n(new Error("dataURLtoImage(): dataURL is illegal")),e.src=o})}function C(o,t){const n=document.createElement("a");n.href=window.URL.createObjectURL(o),n.download=t||Date.now().toString(36),document.body.appendChild(n);const e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),n.dispatchEvent(e),document.body.removeChild(n)}function y(o){return new Promise(t=>{const n=new FileReader;n.onloadend=e=>t(e.target.result),n.readAsDataURL(o)})}var R=function(o,t,n,e){return new(n||(n=Promise))(function(i,d){function h(u){try{m(e.next(u))}catch(a){d(a)}}function f(u){try{m(e.throw(u))}catch(a){d(a)}}function m(u){var a;u.done?i(u.value):(a=u.value,a instanceof n?a:new n(function(b){b(a)})).then(h,f)}m((e=e.apply(o,t||[])).next())})};function O(o,t={}){return R(this,void 0,void 0,function*(){const n=Object.assign({},t),e=document.createElement("canvas"),i=e.getContext("2d");let d,h;for(const f in n)Object.prototype.hasOwnProperty.call(n,f)&&(n[f]=Number(n[f]));if(n.scale){const f=n.scale>0&&n.scale<10?n.scale:1;h=o.width*f,d=o.height*f}else h=n.width||n.height*o.width/o.height||o.width,d=n.height||n.width*o.height/o.width||o.height;switch([5,6,7,8].some(f=>f===n.orientation)?(e.height=h,e.width=d):(e.height=d,e.width=h),n.orientation){case 3:i.rotate(180*Math.PI/180),i.drawImage(o,-e.width,-e.height,e.width,e.height);break;case 6:i.rotate(90*Math.PI/180),i.drawImage(o,0,-e.width,e.height,e.width);break;case 8:i.rotate(270*Math.PI/180),i.drawImage(o,-e.height,0,e.height,e.width);break;case 2:i.translate(e.width,0),i.scale(-1,1),i.drawImage(o,0,0,e.width,e.height);break;case 4:i.translate(e.width,0),i.scale(-1,1),i.rotate(180*Math.PI/180),i.drawImage(o,-e.width,-e.height,e.width,e.height);break;case 5:i.translate(e.width,0),i.scale(-1,1),i.rotate(90*Math.PI/180),i.drawImage(o,0,-e.width,e.height,e.width);break;case 7:i.translate(e.width,0),i.scale(-1,1),i.rotate(270*Math.PI/180),i.drawImage(o,-e.height,0,e.height,e.width);break;default:i.drawImage(o,0,0,e.width,e.height)}return e})}function T(o){return fetch(o).then(t=>t.blob())}function $(o){return new Promise((t,n)=>{const e=new Image;e.onload=()=>t(e),e.onerror=()=>n(new Error("urltoImage(): Image failed to load, please check the image URL")),e.src=o})}var G=function(o,t,n,e){return new(n||(n=Promise))(function(i,d){function h(u){try{m(e.next(u))}catch(a){d(a)}}function f(u){try{m(e.throw(u))}catch(a){d(a)}}function m(u){var a;u.done?i(u.value):(a=u.value,a instanceof n?a:new n(function(b){b(a)})).then(h,f)}m((e=e.apply(o,t||[])).next())})};function X(o,t={}){return G(this,void 0,void 0,function*(){if(!(o instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if(typeof t!="object"&&(t=Object.assign({quality:t})),t.quality=Number(t.quality),Number.isNaN(t.quality))return o;const n=yield y(o);let e=n.split(",")[0].match(/:(.*?);/)[1],i=r.JPEG;l(t.type)&&(i=t.type,e=t.type);const d=yield E(n),h=yield O(d,Object.assign({},t)),f=yield P(h,t.quality,i),m=yield w(f,e);return m.size>o.size?o:m})}function Y(o,t={}){return G(this,void 0,void 0,function*(){if(!(o instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if(typeof t!="object"&&(t=Object.assign({size:t})),t.size=Number(t.size),Number.isNaN(t.size)||1024*t.size>o.size)return o;t.accuracy=Number(t.accuracy),(!t.accuracy||t.accuracy<.8||t.accuracy>.99)&&(t.accuracy=.95);const n=t.size*(2-t.accuracy)*1024,e=1024*t.size,i=t.size*t.accuracy*1024,d=yield y(o);let h=d.split(",")[0].match(/:(.*?);/)[1],f=r.JPEG;l(t.type)&&(f=t.type,h=t.type);const m=yield E(d),u=yield O(m,Object.assign({},t));let a,b=.5;const N=[null,null];for(let M=1;M<=7;M++){a=yield P(u,b,f);const z=.75*a.length;if(M===7){(n<z||i>z)&&(a=[a,...N].filter(L=>L).sort((L,H)=>Math.abs(.75*L.length-e)-Math.abs(.75*H.length-e))[0]);break}if(n<z)N[1]=a,b-=Math.pow(.5,M+1);else{if(!(i>z))break;N[0]=a,b+=Math.pow(.5,M+1)}}const D=yield w(a,h);return D.size>o.size?o:D})}}])})})(V);(function(I){I.exports=V.exports})(J);function de(){const I=U(0),j=U(0),v=s=>{I.value=s.pageX,j.value=s.pageY};return S(()=>{document.addEventListener("click",v)}),Q(()=>{document.removeEventListener("click",v)}),{x:I,y:j}}const fe=["src"],he={class:"el-upload-list__item-actions"},me=["onClick"],pe=["onClick"],ge=["src"],ye=W({__name:"cover",setup(I){de();const j=U(""),v=U(!1),s=U(),c=U(),r=p=>{console.log(p),s.value.handleRemove(p),le({id:p.id}).then(g=>{q({message:"\u5220\u9664\u56FE\u7247\u6210\u529F",type:"success"})})},l=p=>{j.value=p.url,v.value=!0},_=p=>{if(console.log(p),p.size>1024*1024*4)return te({title:"\u63D0\u793A",message:"\u4E0A\u4F20\u56FE\u7247\u8FC7\u5927,\u8981\u538B\u7F29\u56FE\u7247",type:"error",duration:3e3}),new Promise((g,w)=>{J.exports.compressAccurately(p,{size:100,accuracy:.8,type:"image/png",orientation:1,scale:.1}).then(E=>{g(E)})})},P=async p=>{console.log(p);const g=new FormData;g.append("pic",p.file),ue(g).then(w=>{se({del_state:1,img:[w.path]}).then(E=>{q({message:"\u4E0A\u4F20\u56FE\u7247\u6210\u529F",type:"success"})})})};return S(()=>{console.log("object"),ie().then(p=>{c.value=p.data.filter((g,w)=>g.del_state==1).map((g,w)=>({name:ce(),url:g.img,id:g.id}))})}),(p,g)=>{const w=B("el-icon"),E=B("el-upload"),C=B("el-dialog");return ne(),Z(ee,null,[x(E,{action:"#","list-type":"picture-card","http-request":P,"before-upload":_,ref_key:"elUploadRef",ref:s,accept:"image/*","file-list":c.value,"onUpdate:file-list":g[0]||(g[0]=y=>c.value=y)},{file:F(({file:y})=>[k("div",null,[k("img",{class:"el-upload-list__item-thumbnail",src:y.url,alt:""},null,8,fe),k("span",he,[k("span",{class:"el-upload-list__item-preview",onClick:R=>l(y)},[x(w,null,{default:F(()=>[x(A(oe))]),_:1})],8,me),k("span",{class:"el-upload-list__item-delete",onClick:R=>r(y)},[x(w,null,{default:F(()=>[x(A(ae))]),_:1})],8,pe)])])]),default:F(()=>[x(w,null,{default:F(()=>[x(A(re))]),_:1})]),_:1},8,["file-list"]),x(C,{modelValue:v.value,"onUpdate:modelValue":g[1]||(g[1]=y=>v.value=y)},{default:F(()=>[k("img",{style:{width:"100%"},src:j.value,alt:"Preview Image"},null,8,ge)]),_:1},8,["modelValue"])],64)}}});export{ye as default};
